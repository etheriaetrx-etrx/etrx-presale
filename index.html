<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>$ETRX • Etheria Presale</title>
<meta name="description" content="$ETRX — the official utility token of Etheria. Presale on Ethereum."/>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>

<link rel="canonical" href="https://etheriaetrx-etrx.github.io/etrx-presale/">
<meta property="og:title" content="$ETRX • Etheria Presale">
<meta property="og:description" content="The official utility token of Etheria. Presale runs Sep 24 → Oct 1, 2025 (UTC).">
<meta property="og:type" content="website">
<meta property="og:url" content="https://etheriaetrx-etrx.github.io/etrx-presale/">
<meta property="og:image" content="https://etheriaetrx-etrx.github.io/etrx-presale/assets/Background.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@ETRXDreamscapes">

<!-- CSP: injected wallets only -->
<meta http-equiv="Content-Security-Policy"
  content="default-src 'self' https://etheriaetrx-etrx.github.io;
           img-src 'self' data: https:;
           script-src 'self' https://cdn.tailwindcss.com https://cdn.jsdelivr.net 'unsafe-inline';
           style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
           font-src https://fonts.gstatic.com;
           connect-src 'self' https://formspree.io https://cloudflare-eth.com;
           worker-src 'self';
           object-src 'none';
           base-uri 'self';
           frame-ancestors 'none'">

<meta name="theme-color" content="#05070d">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com?v=3"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<link rel="preload" as="image" href="assets/Background.png">
<link rel="icon" type="image/png" href="assets/logo.png">

<style>
:root{
  color-scheme: dark;
  --bg:#05070d;
  --panel:rgba(255,255,255,.06);
  --ring:rgba(0,255,255,.18);
  --dim:rgba(255,255,255,.66);
  --muted:rgba(255,255,255,.88);
  --neon-cyan: 0 255 255;
  --neon-blue: 84 178 255;
  --neon-violet: 208 128 255;
  --neon-orange: 255 147 76;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#fff;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow-x:hidden}

/* Neon look */
.neon-text{
  text-shadow:
    0 0 6px rgba(var(--neon-cyan)/.8),
    0 0 24px rgba(var(--neon-blue)/.45),
    0 0 48px rgba(var(--neon-violet)/.35);
}
.neon-grad{background:linear-gradient(90deg, rgb(var(--neon-orange)), rgb(var(--neon-blue))); -webkit-background-clip:text; background-clip:text; color:transparent}

.glass{backdrop-filter: blur(12px); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); border:1px solid var(--ring)}
.card{border-radius:18px; box-shadow:
  0 0 0 1px rgba(0,255,255,.08) inset,
  0 8px 30px rgba(0,255,255,.08),
  0 0 60px rgba(130, 200, 255, .06)}
.card-outline{position:relative}
.card-outline::before{
  content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
  background: conic-gradient(from 180deg at 50% 50%, rgba(var(--neon-orange)/.7), rgba(var(--neon-blue)/.7), rgba(var(--neon-violet)/.7), rgba(var(--neon-orange)/.7));
  -webkit-mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  filter: blur(8px) saturate(1.4); opacity:.35; animation: spinBorder 10s linear infinite;
}
@keyframes spinBorder { to { transform: rotate(360deg) } }

/* BTN */
.btn-primary{
  position:relative; display:inline-flex; align-items:center; gap:.55rem; padding:.75rem 1rem;
  border-radius:14px; font-weight:800; color:#02040a;
  background:linear-gradient(90deg, rgb(var(--neon-orange)), rgb(var(--neon-blue)));
  box-shadow: 0 0 16px rgba(255,147,76,.45), 0 0 24px rgba(84,178,255,.35);
}
.btn-primary:hover{ transform: translateY(-1px) scale(1.01) }
.btn-ghost{
  border:1px solid rgba(0,255,255,.25);
  background: rgba(255,255,255,.03);
  padding:.6rem .9rem; border-radius:12px;
}
.hidden-important{ display:none !important }
.small-dim{ color:var(--dim) }
.title-glow{ text-shadow:0 0 14px rgba(0,255,255,.3), 0 0 36px rgba(84,178,255,.25) }
.tabular{ font-variant-numeric: tabular-nums }

/* Starfield canvas */
#orbCanvas{ position:fixed; inset:0; z-index:0; pointer-events:none; filter:drop-shadow(0 0 24px rgba(0,255,255,.12)) }
.scanlines{ position:fixed; inset:0; z-index:0; pointer-events:none;
  background: repeating-linear-gradient( to bottom, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 2px, transparent 4px );
  mix-blend-mode: soft-light; opacity:.20;
}

/* (NEW) Holographic foil hover for cards */
.holo{ position:relative; overflow:hidden; }
.holo::after{
  content:""; position:absolute; inset:-150% -150%;
  background:
    conic-gradient(from 0deg, #fff0, #fff3 10%, #fff0 20%),
    linear-gradient(120deg, #ff934c55, #54b2ff55, #d080ff55);
  mix-blend-mode:screen; filter:saturate(1.4) blur(10px); opacity:.25;
  transform:translateX(-30%);
  transition: transform .8s ease, opacity .3s ease;
}
.holo:hover::after{ transform:translateX(30%); opacity:.45 }

/* (NEW) Animated underline links (neon laser) */
a.laser{
  background: linear-gradient(90deg, #00ffff 0 0) bottom left / 0 2px no-repeat;
  transition: background-size .3s ease;
}
a.laser:hover{ background-size: 100% 2px; text-shadow:0 0 10px #00ffff66 }

/* (NEW) FAQ neon separators */
.faq-item{ border:1px solid #00ffff22; border-radius:14px; overflow:hidden }
.faq-header{ position:relative; width:100%; display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:1rem 1.25rem; text-align:left }
.faq-header::after{
  content:""; position:absolute; left:0; right:0; bottom:0; height:1px;
  background: linear-gradient(90deg, #00ffff44, transparent);
}
.faq-body{ padding: 0 1.25rem; max-height:0; transition:max-height .28s ease, padding .2s ease }
.faq-body.open { padding: .25rem 1.25rem 1rem; }
.faq-chevron { transition: transform .25s ease }
.faq-item.open{ box-shadow:0 0 24px #00ffff22 inset }

/* (NEW) Hero image reflection */
.hero-reflect{ position:relative; overflow:hidden }
.hero-reflect::after{
  content:""; position:absolute; top:-40%; left:-30%; width:60%; height:180%;
  transform: rotate(25deg); pointer-events:none; opacity:.12;
  background: linear-gradient( to right, transparent 0, #fff6 30%, transparent 60% );
  filter: blur(12px);
}
.hero-reflect:hover::after{ opacity:.18 }

@media (prefers-reduced-motion: reduce){
  *{ animation-duration:.001ms !important; animation-iteration-count:1 !important; transition:none !important }
  .card-outline::before{ display:none }
  .holo::after{ display:none }
}
</style>
</head>
<body>
<canvas id="orbCanvas" aria-hidden="true"></canvas>
<div class="scanlines" aria-hidden="true"></div>

<header class="relative z-10 mx-auto flex max-w-6xl items-center justify-between px-6 py-5">
  <div class="flex items-center gap-3">
    <img src="assets/logo.png" alt="Etheria Logo" class="h-10 w-10 rounded-xl ring-1 ring-cyan-400/20 object-contain bg-white/5"/>
    <div class="text-sm tracking-wide small-dim">Etheria</div>
  </div>
  <nav class="hidden gap-6 text-sm opacity-80 md:flex" aria-label="Primary">
    <a class="laser hover:opacity-100" href="#about">About</a>
    <a class="laser hover:opacity-100" href="#token">Tokenomics</a>
    <a class="laser hover:opacity-100" href="#road">Road</a>
    <a class="laser hover:opacity-100" href="#faq">FAQ</a>
  </nav>
  <div class="flex items-center gap-3">
    <button id="connectBtn" class="btn-primary text-sm">Connect Wallet</button>
    <div id="walletPill" class="btn-ghost text-xs hidden">
      <span id="walletShort" class="addr"></span>
      <button id="disconnectBtn" class="ml-2 underline underline-offset-4">Disconnect</button>
    </div>
  </div>
</header>

<!-- Wallet modal (injected only) -->
<div id="walletModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
  <div class="glass card card-outline w-[min(420px,92vw)] p-4">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold neon-text">Choose a wallet</h3>
      <button id="modalClose" class="text-white/70 hover:text-white">✕</button>
    </div>
    <p class="mt-1 text-xs small-dim">Use a browser wallet (MetaMask, Rabby, Brave, Frame, etc.).</p>
    <div id="walletList" class="mt-4 grid gap-2"></div>
    <p class="mt-2 text-xs small-dim">Tip: If nothing shows up, install a wallet extension or use a browser with a built-in wallet.</p>
  </div>
</div>

<!-- Hero -->
<section class="relative z-10 mx-auto grid max-w-6xl grid-cols-1 items-stretch gap-10 px-6 pb-16 pt-6 md:grid-cols-2 md:pt-10">
  <div class="order-2 md:order-1">
    <h1 class="title-glow neon-text text-4xl font-extrabold leading-tight md:text-6xl">
      The Official Token of Etheria<br/>
      <span class="neon-grad">$ETRX Presale</span>
    </h1>
    <p class="mt-4 max-w-prose small-dim">Powering realms, artifacts, governance and community rewards. Built on Ethereum for permanence and reach.</p>

    <!-- Countdown -->
    <div class="mt-8 glass card card-outline p-5">
      <div id="phaseLabel" class="mb-2 text-xs uppercase tracking-widest small-dim">Presale begins in — <span id="modeLabel">UTC</span></div>
      <div id="countdown" class="flex gap-3 text-center" aria-live="polite"></div>

      <div class="mt-3 text-xs flex flex-col gap-1 small-dim">
        <div id="whenPrimary" class="text-sm text-white/90"></div>
        <div id="whenSecondary"></div>
        <button id="tzToggle" class="mt-2 self-start underline underline-offset-4 opacity-90 hover:opacity-100">Make Local primary</button>
      </div>

      <!-- Progress -->
      <div class="mt-4">
        <div class="flex items-center justify-between text-xs small-dim">
          <span>Phase: Presale</span><span id="phaseEta"></span>
        </div>
        <div class="mt-2 h-2 w-full overflow-hidden rounded-full bg-white/10">
          <div id="phaseBar" class="h-full" style="background:linear-gradient(90deg, rgba(var(--neon-orange),1), rgba(var(--neon-blue),1)); width:0%"></div>
        </div>
      </div>
    </div>

    <ul class="mt-6 grid grid-cols-2 gap-3 text-sm sm:text-base">
      <li class="glass card holo p-4"><span class="inline-block w-2 h-2 rounded-full bg-cyan-400 mr-2"></span>Supply: <b>10,000,000</b></li>
      <li class="glass card holo p-4"><span class="inline-block w-2 h-2 rounded-full bg-cyan-400 mr-2"></span>Network: <b>Ethereum</b></li>
      <li class="glass card holo p-4"><span class="inline-block w-2 h-2 rounded-full bg-cyan-400 mr-2"></span>Symbol: <b>ETRX</b></li>
      <li class="glass card holo p-4"><span class="inline-block w-2 h-2 rounded-full bg-cyan-400 mr-2"></span>Presale: <b>Sep 24 → Oct 1</b></li>
    </ul>

    <div class="mt-4 text-xs small-dim">
      <b>What happens next?</b> After the presale window closes, we proceed to Token Generation Event (TGE), distribution, and initial listings/liquidity.
    </div>

    <div class="mt-6 flex flex-wrap items-center gap-3 text-sm small-dim">
      <span>Follow updates:</span>
      <a class="laser hover:text-white" href="https://x.com/ETRXDreamscapes" target="_blank" rel="noopener noreferrer">Twitter</a>
    </div>
    <div class="mt-4 flex flex-wrap items-center gap-3">
      <button id="shareLaunch" class="btn-primary text-sm"><span>Share this launch</span></button>
      <button id="openConnect" class="btn-ghost text-sm">Connect Wallet</button>
    </div>
  </div>

  <!-- Hero image -->
  <div class="order-1 md:order-2 h-[360px] md:h-[560px] lg:h-[620px]">
    <img src="assets/Background.png" alt="Etheria Background" width="1280" height="720"
      class="h-full w-full rounded-3xl ring-1 ring-cyan-400/15 object-cover hero-reflect" loading="eager" decoding="async"
      onerror="this.outerHTML='<div class=&quot;h-full w-full rounded-3xl ring-1 ring-white/10 bg-gradient-to-br from-cyan-500/10 via-blue-500/10 to-orange-500/10 flex items-center justify-center text-white/50&quot;>Background image missing</div>'"/>
  </div>
</section>

<!-- About -->
<section id="about" class="relative z-10 mx-auto max-w-6xl px-6 py-12">
  <h2 class="text-2xl font-bold neon-text">What is $ETRX?</h2>
  <p class="mt-3 max-w-3xl small-dim">
    $ETRX is the utility token of Etheria — used to unlock rare Realms &amp; Artifacts, vote on lore and direction,
    access exclusive drops, and power the Etherian economy. Holders may receive airdrops and in-world benefits.
  </p>
</section>

<!-- Tokenomics -->
<section id="token" class="relative z-10 mx-auto max-w-6xl px-6">
  <h2 class="text-2xl font-bold neon-text">Tokenomics (Overview)</h2>
  <div class="mt-5 grid grid-cols-1 gap-4 md:grid-cols-3">
    <div class="glass card card-outline holo p-5"><b>Utility</b><br/><span class="small-dim">Access to Realms &amp; Artifacts, governance votes, allowlists, and in-world boosts.</span></div>
    <div class="glass card card-outline holo p-5"><b>Distribution Model</b><br/><span class="small-dim">Phased: presale participants, ecosystem growth, contributors, liquidity, reserves.</span></div>
    <div class="glass card card-outline holo p-5"><b>Lockups &amp; Cliff</b><br/><span class="small-dim">Contributor and reserve tranches unlock gradually to align long-term incentives.</span></div>
    <div class="glass card card-outline holo p-5"><b>Emissions</b><br/><span class="small-dim">No hard farming emissions at launch; rewards focus on quests and on-chain participation.</span></div>
    <div class="glass card card-outline holo p-5"><b>Liquidity Approach</b><br/><span class="small-dim">Initial pools post-TGE with transparent on-chain adds; bridge exploration comes later.</span></div>
    <div class="glass card card-outline holo p-5"><b>Governance</b><br/><span class="small-dim">Progressive decentralization — votes start with lore/world decisions.</span></div>
  </div>
  <p class="mt-3 text-xs small-dim">Note: Detailed allocations/percentages will be shared closer to TGE.</p>
</section>

<!-- Road -->
<section id="road" class="relative z-10 mx-auto max-w-6xl px-6 py-14">
  <h2 class="text-2xl font-bold neon-text">Road to Mainnet</h2>
  <ol class="mt-5 grid grid-cols-1 gap-4 sm:grid-cols-2 small-dim">
    <li class="glass card holo p-4">1) Launch site &amp; whitelist open</li>
    <li class="glass card holo p-4">2) Community reveal + partnerships</li>
    <li class="glass card holo p-4">3) Presale window opens (this page)</li>
    <li class="glass card holo p-4">4) TGE: distribution to presale wallets</li>
    <li class="glass card holo p-4 sm:col-span-2">5) Initial listings + liquidity + bridge planning</li>
  </ol>
</section>

<!-- Notify & Allowlist -->
<section id="notify" class="relative z-10 mx-auto max-w-6xl px-6 pb-24">
  <div class="glass card card-outline holo p-6">
    <h3 class="text-xl font-semibold neon-text">Get notified when the presale opens</h3>

    <form id="notifyForm" class="mt-4 flex flex-col gap-3 sm:flex-row"
          action="https://formspree.io/f/mandalyp" method="POST" data-formspree="true" novalidate>
      <label class="sr-only" for="email">Email</label>
      <input required id="email" name="email" type="email" placeholder="you@example.com"
             class="flex-1 rounded-2xl border border-cyan-400/20 bg-white/5 px-4 py-3 outline-none placeholder:text-white/40 focus:ring-2 focus:ring-cyan-400"/>
      <input type="hidden" name="form_name" value="notify"/>
      <input type="hidden" name="_redirect" value="https://etheriaetrx-etrx.github.io/etrx-presale/#notify-success">
      <button class="btn-primary" type="submit">Notify Me</button>
    </form>

    <div id="notifySuccess" class="hidden mt-4 glass card p-5">
      <div class="text-sm">✅ Thanks! Please check your inbox to confirm your email.</div>
      <div class="mt-1 text-xs small-dim">Tip: If you don’t see it, look in spam/promotions.</div>
    </div>

    <p id="notifyMsg" class="mt-2 text-xs hidden small-dim" aria-live="polite"></p>
    <p class="mt-1 text-xs small-dim">We only use your info for presale notifications. No spam.</p>

    <div class="mt-8">
      <h4 class="text-base font-semibold neon-text">Join the allowlist</h4>
      <form id="wlForm" class="mt-3 grid gap-3 sm:grid-cols-[1fr_auto]"
            action="https://formspree.io/f/mandalyp" method="POST" data-formspree="true" novalidate>
        <label class="sr-only" for="wallet">Ethereum wallet or ENS</label>
        <input id="wallet" name="wallet" inputmode="text" autocomplete="off" placeholder="0x… or yourname.eth"
               class="rounded-2xl border border-cyan-400/20 bg-white/5 px-4 py-3 outline-none placeholder:text-white/40 focus:ring-2 focus:ring-cyan-400" />
        <input type="text" name="company" class="hidden" tabindex="-1" autocomplete="off" />
        <input type="hidden" name="type" value="allowlist" />
        <button class="btn-primary" type="submit">Join Allowlist</button>
      </form>

      <p id="wlHelp" class="mt-2 text-xs small-dim"></p>
      <div id="wlSuccess" class="hidden mt-3 glass card p-5 sm:col-span-2">
        <div class="text-sm">✅ Wallet submitted! We’ll verify allowlist details before presale.</div>
        <div class="mt-1 text-xs small-dim">You’ll be notified by email before the window opens.</div>
      </div>
      <p id="wlMsg" class="mt-2 text-xs hidden small-dim" aria-live="polite"></p>
    </div>
  </div>
</section>

<footer class="relative z-10 border-t border-cyan-400/15 py-10 small-dim">
  <div class="mx-auto flex max-w-6xl flex-col items-center justify-between gap-3 px-6 text-sm">
    <div>© <span id="year"></span> Etheria • $ETRX</div>
    <div class="flex items-center gap-4"><a class="laser hover:text-white" href="https://x.com/ETRXDreamscapes" target="_blank" rel="noopener noreferrer">Twitter</a></div>
  </div>
</footer>

<a href="#notify" id="stickyCTA" class="fixed left-1/2 bottom-4 z-50 hidden -translate-x-1/2 rounded-full px-5 py-3 text-sm btn-primary shadow-lg">Get notified for $ETRX</a>

<script>
/* ===== Presale window (UTC) ===== */
const PRESALE_START = new Date('2025-09-24T00:00:00Z');
const PRESALE_END   = new Date('2025-10-01T00:00:00Z');

const $ = (id)=> document.getElementById(id);
const phaseLabel=$('phaseLabel'), countdown=$('countdown'), whenPrimary=$('whenPrimary'),
      whenSecondary=$('whenSecondary'), modeLabel=$('modeLabel');
const connectBtn=$('connectBtn'), openConnect=$('openConnect'), modal=$('walletModal'), modalClose=$('modalClose');
const walletList=$('walletList'), walletPill=$('walletPill'), walletShort=$('walletShort'), disconnectBtn=$('disconnectBtn');

$('year').textContent = new Date().getFullYear();

/* time formatting */
const fmtBase = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit', hour12:true };
const fmtUTC  = (d)=> d.toLocaleString([], { ...fmtBase, timeZone:'UTC', timeZoneName:'short' });
const fmtLoc  = (d)=> d.toLocaleString([], { ...fmtBase, timeZoneName:'short' });

let primaryUTC = true;
function updateWhen(){
  if (primaryUTC){
    whenPrimary.textContent   = `Presale: ${fmtUTC(PRESALE_START)} → ${fmtUTC(PRESALE_END)}`;
    whenSecondary.textContent = `Local time: ${fmtLoc(PRESALE_START)} → ${fmtLoc(PRESALE_END)}`;
    modeLabel.textContent='UTC';
    tzToggle.textContent='Make Local primary';
  } else {
    whenPrimary.textContent   = `Presale: ${fmtLoc(PRESALE_START)} → ${fmtLoc(PRESALE_END)}`;
    whenSecondary.textContent = `UTC time: ${fmtUTC(PRESALE_START)} → ${fmtUTC(PRESALE_END)}`;
    modeLabel.textContent='Local';
    tzToggle.textContent='Make UTC primary';
  }
}
const tzToggle = document.getElementById('tzToggle'); tzToggle?.addEventListener('click', ()=>{ primaryUTC=!primaryUTC; updateWhen(); });

/* precision clock */
const t0 = Date.now(), p0 = performance.now();
const nowAccurate = ()=> new Date(t0 + (performance.now()-p0));

function phase(now){ if(now < PRESALE_START) return 'upcoming'; if(now > PRESALE_END) return 'ended'; return 'live'; }
function box(v,label){
  const d=document.createElement('div');
  d.className='w-22 rounded-xl glass card p-3 text-center';
  d.innerHTML=`<div class="text-3xl font-extrabold tabular neon-text">${String(v).padStart(2,'0')}</div><div class="text-[11px] uppercase small-dim">${label}</div>`;
  return d;
}
let lastSecond=-1;
function loop(){
  const now = nowAccurate(); const ph=phase(now);
  if (phaseLabel){ phaseLabel.innerHTML = `Presale ${ph==='upcoming'?'begins':'ends'} in — <span>${primaryUTC?'UTC':'Local'}</span>`; }
  const target = ph==='upcoming'?PRESALE_START:ph==='live'?PRESALE_END:now;
  const diff = Math.max(0, target-now); const s=Math.floor(diff/1000);
  if(s!==lastSecond){ lastSecond=s; const d=Math.floor(s/86400),h=Math.floor((s%86400)/3600),m=Math.floor((s%3600)/60),ss=s%60; countdown.replaceChildren(box(d,'d'),box(h,'h'),box(m,'m'),box(ss,'s')); }
  requestAnimationFrame(loop);
}
updateWhen(); loop();

/* progress */
const phaseBar=$('phaseBar'); const phaseEta=$('phaseEta');
function updateProgress(){
  const now=new Date();
  let pct=0; if(now<=PRESALE_START) pct=0; else if(now>=PRESALE_END) pct=100; else pct=((now-PRESALE_START)/(PRESALE_END-PRESALE_START))*100;
  if(phaseBar) phaseBar.style.width=`${pct}%`;
  const endIn=Math.max(0,PRESALE_END-now); const hrs=Math.floor(endIn/36e5), mins=Math.floor((endIn%36e5)/6e4);
  if(phaseEta) phaseEta.textContent=(endIn===0)?'Ended':`Ends in ${hrs}h ${String(mins).padStart(2,'0')}m`;
}
updateProgress(); setInterval(updateProgress, 30_000);

/* sticky CTA timing */
const SHOW_BAR_DAYS = 14;
function toggleBar(){
  const days=(PRESALE_START - new Date())/86400000;
  document.getElementById('stickyCTA').classList.toggle('hidden', !(window.innerWidth < 768 && days>0 && days<=SHOW_BAR_DAYS));
}
toggleBar(); setInterval(toggleBar, 60_000);

/* smooth anchors */
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', e=>{
    const id=a.getAttribute('href').slice(1); const el=document.getElementById(id); if(!el) return;
    e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}); history.replaceState(null,'','#'+id);
  });
});

/* FAQ expand + neon open state */
document.querySelectorAll('.faq-item')?.forEach(item=>{
  const btn=item.querySelector('.faq-header'); const body=item.querySelector('.faq-body'); const chev=item.querySelector('.faq-chevron');
  btn.addEventListener('click', ()=>{
    const open=item.classList.contains('open');
    if(!open){
      item.classList.add('open');
      btn.setAttribute('aria-expanded','true');
      body.hidden=false; body.style.maxHeight=body.scrollHeight+'px'; body.classList.add('open'); chev.style.transform='rotate(180deg)';
    } else {
      btn.setAttribute('aria-expanded','false');
      body.style.maxHeight=body.scrollHeight+'px';
      requestAnimationFrame(()=>{ body.style.maxHeight='0px'; body.classList.remove('open'); chev.style.transform='rotate(0deg)'; });
      body.addEventListener('transitionend', ()=>{ if(body.style.maxHeight==='0px') body.hidden=true; item.classList.remove('open'); }, {once:true});
    }
  });
});

/* ===== Formspree (AJAX) ===== */
const FORMSPREE_ENDPOINT = 'https://formspree.io/f/mandalyp';
async function postFormspree(data){
  const res=await fetch(FORMSPREE_ENDPOINT,{ method:'POST', headers:{ 'Content-Type':'application/json', 'Accept':'application/json' }, body: JSON.stringify(data) });
  if(!res.ok) throw new Error('Bad response'); return res.json().catch(()=>({}));
}
const notifyForm=$('notifyForm'), notifyMsg=$('notifyMsg'), notifySuccess=$('notifySuccess');
if (notifyForm){
  notifyForm.addEventListener('submit', async (e)=>{
    e.preventDefault(); notifyMsg.classList.add('hidden');
    try{ const fd=new FormData(notifyForm); await postFormspree(Object.fromEntries(fd.entries())); notifyForm.classList.add('hidden'); notifySuccess.classList.remove('hidden'); }
    catch(err){ notifyMsg.textContent='Submission failed. Please check your connection and try again.'; notifyMsg.classList.remove('hidden'); }
  });
}
if(location.hash==='#notify-success'){ notifyForm?.classList.add('hidden'); notifySuccess?.classList.remove('hidden'); }

/* ===== ENS-aware allowlist ===== */
const wlForm=$('wlForm'), wlMsg=$('wlMsg'), wlHelp=$('wlHelp'), wlSuccess=$('wlSuccess');
const addrRe=/^0x[a-fA-F0-9]{40}$/; const ensRe=/^[a-z0-9-]+(\.[a-z0-9-]+)*\.eth$/i;
function setHelp(text, ok=false){ wlHelp.textContent=text||''; wlHelp.style.color= ok ? 'var(--muted)' : 'var(--dim)'; }
const providerENS = new (window.ethers?.providers.JsonRpcProvider || function(){})('https://cloudflare-eth.com');
async function resolveIfEns(value){ if(!value || !ensRe.test(value)) return null; try{ if(!providerENS || !providerENS.resolveName) return null; const resolved=await providerENS.resolveName(value); return resolved||null; }catch{ return null; } }
if (wlForm){
  const walletInput=$('wallet');
  walletInput.addEventListener('input', async ()=>{
    wlMsg.classList.add('hidden'); const v=walletInput.value.trim(); if(!v){ setHelp(''); return; }
    if(addrRe.test(v)){ setHelp('Looks like a valid Ethereum address.', true); return; }
    if(ensRe.test(v)){ setHelp('Checking ENS…'); const addr=await resolveIfEns(v); setHelp(addr?`ENS resolved to ${addr.slice(0,6)}…${addr.slice(-4)}.`:'Could not resolve this ENS name.', !!addr); return; }
    setHelp('Enter a valid 0x… address or an ENS name like yourname.eth');
  });
  wlForm.addEventListener('submit', async (e)=>{
    e.preventDefault(); wlMsg.classList.add('hidden');
    const fd=new FormData(wlForm); const trap=(fd.get('company')||'').trim(); let wallet=(fd.get('wallet')||'').trim(); if(trap) return;
    let finalAddr=null;
    if(addrRe.test(wallet)){ finalAddr=wallet; }
    else if(ensRe.test(wallet)){ wlHelp.textContent='Resolving ENS…'; const resolved=await resolveIfEns(wallet);
      if(resolved) finalAddr=resolved; else { wlMsg.textContent='Enter a valid address, or a resolvable ENS name.'; wlMsg.classList.remove('hidden'); return; } }
    else { wlMsg.textContent='Enter a valid 0x… address or ENS name (yourname.eth).'; wlMsg.classList.remove('hidden'); return; }
    try{ const list=JSON.parse(localStorage.getItem('etrx_wl')||'[]'); if(!list.includes(finalAddr)) list.push(finalAddr);
      localStorage.setItem('etrx_wl', JSON.stringify(list)); await postFormspree({ wallet: finalAddr, type: 'allowlist' });
      wlForm.classList.add('hidden'); wlSuccess.classList.remove('hidden');
    }catch(err){ wlMsg.textContent='Saved locally. Network submit failed — please try again later.'; wlMsg.classList.remove('hidden'); }
  });
}

/* ===== Injected wallet connection only ===== */
let activeProvider=null;
function shortAddr(a){ return a ? `${a.slice(0,6)}…${a.slice(-4)}` : ''; }
function showModal(show){ modal.classList.toggle('hidden', !show); modal.classList.toggle('flex', show); }

async function ensureMainnet(provider, hexChain='0x1'){
  try{
    const current=await provider.request({ method:'eth_chainId' });
    if(current?.toLowerCase()===hexChain.toLowerCase()) return true;
    await provider.request({ method:'wallet_switchEthereumChain', params:[{ chainId: hexChain }] });
    return true;
  } catch(err){ console.warn('Chain switch failed', err); return false; }
}

function discoverInjected(){
  walletList.innerHTML = '';
  const providers = []; const announced = [];
  function onAnnounce(e){ announced.push(e.detail); }
  window.addEventListener('eip6963:announceProvider', onAnnounce, { once:false });
  window.dispatchEvent(new Event('eip6963:requestProvider'));
  if (window.ethereum){
    if(window.ethereum.providers?.length){ window.ethereum.providers.forEach(p=> providers.push(p)); }
    else { providers.push(window.ethereum); }
  }
  const entries=[];
  if(announced.length){ announced.forEach(({info,provider})=> entries.push({ name: info?.name || 'Browser Wallet', provider })); }
  else if(providers.length){
    providers.forEach(p=>{
      const name = p.isMetaMask ? 'MetaMask' : p.isBraveWallet ? 'Brave Wallet' : p.isRabby ? 'Rabby' : p.isFrame ? 'Frame' : 'Browser Wallet';
      entries.push({ name, provider:p });
    });
  }
  if(!entries.length){
    const btn=document.createElement('button');
    btn.className='btn-ghost opacity-70 cursor-not-allowed'; btn.disabled=true;
    btn.innerHTML='No browser wallet detected';
    walletList.appendChild(btn); return;
  }
  entries.forEach(({name,provider})=>{
    const btn=document.createElement('button');
    btn.className='btn-ghost text-left'; btn.style.display='flex'; btn.style.justifyContent='space-between';
    btn.innerHTML=`<span>🧩 ${name}</span><span class="small-dim">Use extension</span>`;
    btn.addEventListener('click', async ()=>{
      showModal(false);
      try{ const accounts=await provider.request({ method:'eth_requestAccounts' }); await onConnected(provider, accounts?.[0]||null); }
      catch(err){ console.warn('Injected connect error', err); }
    });
    walletList.appendChild(btn);
  });
}
async function onConnected(provider, account){
  activeProvider = provider;
  await ensureMainnet(provider);
  localStorage.setItem('etrx_wallet', account||'');
  walletShort.textContent = shortAddr(account||'');
  walletPill.classList.remove('hidden');
  connectBtn.classList.add('hidden-important');
  openConnect?.classList.add('hidden-important');
  provider.on?.('accountsChanged', (accs)=>{ walletShort.textContent=shortAddr(accs?.[0]||''); localStorage.setItem('etrx_wallet', accs?.[0]||''); });
  provider.on?.('disconnect', ()=>{ doDisconnect(); });
  provider.on?.('chainChanged', async ()=>{ await ensureMainnet(provider); });
}
function doDisconnect(){
  try{ activeProvider?.disconnect?.(); }catch{}
  activeProvider=null; localStorage.removeItem('etrx_wallet');
  walletPill.classList.add('hidden');
  connectBtn.classList.remove('hidden-important');
  openConnect?.classList.remove('hidden-important');
}
disconnectBtn.addEventListener('click', doDisconnect);
function openModal(){ discoverInjected(); showModal(true); }
[connectBtn, openConnect].forEach(btn=> btn?.addEventListener('click', openModal));
modalClose.addEventListener('click', ()=> showModal(false));
modal.addEventListener('click', (e)=>{ if(e.target===modal) showModal(false); });

/* Restore previous session */
const prev = localStorage.getItem('etrx_wallet');
if (prev){ walletShort.textContent = shortAddr(prev); walletPill.classList.remove('hidden'); connectBtn.classList.add('hidden-important'); openConnect?.classList.add('hidden-important'); }

/* Share */
const shareBtn=$('shareLaunch');
if (shareBtn && navigator.share){ shareBtn.addEventListener('click', async ()=>{ try{ await navigator.share({ title:'$ETRX • Etheria Presale', text:'Presale runs Sep 24 → Oct 1 (UTC). Join the allowlist.', url: location.href }); }catch{} }); }
else if(shareBtn){ shareBtn.addEventListener('click', ()=>{ navigator.clipboard.writeText(location.href); shareBtn.textContent='Link copied!'; setTimeout(()=>shareBtn.textContent='Share this launch', 1500); }); }
</script>

<!-- Starfield with CONSTELLATION lines -->
<script>
(function(){
  const canvas=document.getElementById('orbCanvas'), ctx=canvas.getContext('2d');
  if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  let w,h,dpr,stars=[],running=true;

  function resize(){
    dpr=Math.min(devicePixelRatio||1,2);
    w=canvas.width=Math.floor(innerWidth*dpr);
    h=canvas.height=Math.floor(innerHeight*dpr);
    canvas.style.width=innerWidth+'px'; canvas.style.height=innerHeight+'px';
    init();
  }
  function rand(a,b){ return a+Math.random()*(b-a) }
  function makeStar(depth=1){
    const r=rand(.6,1.8)*(4-depth)*dpr*.45, speed=rand(.03,.12)*(4-depth)*dpr,
          x=rand(0,w), y=rand(0,h);
    const tone = Math.random()<.5 ? `rgba(${'0,255,255'},` : `rgba(${'84,178,255'},`;
    const alphaBase=rand(.45,.8), twinkleAmp=rand(.25,.6), twinkleSpd=rand(.002,.006), dir=Math.random()<.5?-1:1;
    return {x,y,r,speed,depth,tone,alphaBase,twinkleAmp,twinkleSpd,dir,t:rand(0,Math.PI*2)};
  }
  function init(){
    const baseDensity=(innerWidth*innerHeight)/16000;
    const cores=(navigator.hardwareConcurrency||4);
    const density=Math.round(baseDensity * Math.min(1, cores/8));
    stars=[]; for(let i=0;i<density;i++) stars.push(makeStar(i%3+1));
  }
  function drawStar(s){
    s.t+=s.twinkleSpd; const a=s.alphaBase+Math.sin(s.t)*s.twinkleAmp*.25;
    const g=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.r*4);
    g.addColorStop(0, `${s.tone}${a})`); g.addColorStop(1, `${s.tone}0)`);
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(s.x,s.y,s.r*4,0,Math.PI*2); ctx.fill();
    ctx.fillStyle=`${s.tone}${Math.min(1,a+.08)})`; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
  }
  function drawConstellations(){
    // connect near neighbors for a subtle constellation effect
    // limit comparisons for perf: only check next few stars
    ctx.lineWidth=0.7*dpr;
    for (let i=0;i<stars.length;i++){
      const a=stars[i];
      for (let j=i+1;j<i+8 && j<stars.length;j++){
        const b=stars[j];
        const dx=a.x-b.x, dy=a.y-b.y;
        const dist2=dx*dx+dy*dy;
        if (dist2 < (60*dpr)*(60*dpr)){ // ~60px neighborhood
          const near = 1 - Math.sqrt(dist2)/(60*dpr);
          ctx.strokeStyle=`rgba(84,178,255,${0.04 + 0.08*near})`;
          ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
        }
      }
    }
  }
  function step(){
    if(!running) return;
    ctx.clearRect(0,0,w,h);
    for(const s of stars){
      s.y+=s.speed*s.dir;
      s.x+=Math.sin((s.y+s.depth*40)*.001)*.2*(4-s.depth);
      if(s.y<-10) s.y=h+10; if(s.y>h+10) s.y=-10; if(s.x<-10) s.x=w+10; if(s.x>w+10) s.x=-10;
      drawStar(s);
    }
    drawConstellations();
    requestAnimationFrame(step);
  }
  resize(); step();
  addEventListener('resize',resize,{passive:true});
  addEventListener('visibilitychange',()=>{running=document.visibilityState==='visible'; if(running) requestAnimationFrame(step);});
})();
</script>
</body>
</html>
